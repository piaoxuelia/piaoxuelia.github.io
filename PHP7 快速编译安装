PHP7 快速编译安装

第一步： 安装必要一些依赖
# yum install php-mcrypt libmcrypt libmcrypt-devel  libxml2-devel  openssl-devel  libcurl-devel libjpeg.x86_64 libpng.x86_64 freetype.x86_64 libjpeg-devel.x86_64 libpng-devel.x86_64 freetype-devel.x86_64  libjpeg-turbo-devel   libmcrypt-devel   mysql-devel  -y

第二步： 下载php7源码包
官网：http://php.net/downloads.php

找到下载包镜像 如 http://am1.php.net/get/php-7.1.8.tar.gz/from/this/mirror

# wget http://am1.php.net/get/php-7.1.8.tar.gz/from/this/mirror

下载后，会看到目录中生成了镜像 mirror

# tar -xzvf mirror
# cd php-7.1.8

第三步： 编译安装
# './configure' '--prefix=/usr/local/php7' '--with-config-file-path=/usr/local/php7/etc' '--with-mcrypt=/usr/include' '--enable-mysqlnd' '--with-gd' '--with-iconv' '--with-zlib' '--enable-bcmath' '--enable-shmop' '--enable-sysvsem' '--enable-inline-optimization' '--enable-mbregex' '--enable-fpm' '--enable-mbstring' '--enable-ftp' '--enable-gd-native-ttf' '--with-openssl' '--enable-pcntl' '--enable-sockets' '--with-xmlrpc' '--enable-zip' '--enable-soap' '--with-gettext' '--with-curl' '--with-jpeg-dir' '--with-freetype-dir' '--with-mysqli' '--enable-embedded-mysqli'  '--with-pdo-mysql'

# make   （编译，此处花时间较长）
# make install  （安装）

第四步： 配置php

cp php.ini-production /usr/local/php7/etc/php.ini

cp sapi/fpm/init.d.php-fpm /etc/init.d/php7-fpm

chmod +x /etc/init.d/php7-fpm

cp /usr/local/php7/etc/php-fpm.conf.default /usr/local/php7/etc/php-fpm.conf

cp /usr/local/php7/etc/php-fpm.d/www.conf.default /usr/local/php7/etc/php-fpm.d/www.conf

vim /usr/local/php7/etc/php.ini

# 加入

zend_extension=/usr/local/php7/lib/php/extensions/no-debug-non-zts-***/opcache.so
（其中，***是一个日期）

# 启动

/etc/init.d/php7-fpm start

# 查看PHP版本

/usr/local/php7/bin/php -v

如果未找到此命令，说明没有环境变量中没有php这个路径，找不到命令，需要配置环境变量地址
1.临时配置：在命令行
export PATH=$PATH:/usr/local/php7/bin

此时便能执行 php -v 查看版本信息，但仅限于当前会话

2.永久生效
sudo vi /etc/profile

最后一行加上
PATH=$PATH:/usr/local/php7/bin
export PATH

保存退出

执行 命令source /etc/profile
或 执行点命令 ./profile使其修改生效
echo $PATH 查看是否添加成功

为了安全最好是去掉头信息  X-Powered-By: PHP/7.*.*

则修改 php.ini 文件 设置 expose_php = Off

vim /usr/local/php7/etc/php.ini

找到 expose_php = On

改为 expose_php = Off
